<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>NF6 Capital &mdash; HomeBase</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

/* ── THEME VARIABLES ── */
:root, [data-theme="light"] {
  --bg:#f5f7fa;--card:#fff;--border:#e2e8f0;--text:#1a202c;--text2:#64748b;
  --accent:#2563eb;--accent-lt:#eff6ff;--green:#16a34a;--green-bg:#f0fdf4;
  --yellow:#ca8a04;--yellow-bg:#fefce8;--red:#dc2626;--red-bg:#fef2f2;
  --orange:#ea580c;--orange-bg:#fff7ed;--purple:#7c3aed;--purple-bg:#f5f3ff;
  --nav:#0f172a;--nav-hover:#1e293b;--card-shadow:0 1px 3px rgba(0,0,0,.06);
  --hero-gradient:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);
}
[data-theme="dark"] {
  --bg:#0f172a;--card:#1e293b;--border:#334155;--text:#e2e8f0;--text2:#94a3b8;
  --accent:#60a5fa;--accent-lt:#1e3a5f;--green:#4ade80;--green-bg:#064e3b;
  --yellow:#fbbf24;--yellow-bg:#713f12;--red:#f87171;--red-bg:#7f1d1d;
  --orange:#fb923c;--orange-bg:#7c2d12;--purple:#a78bfa;--purple-bg:#4c1d95;
  --nav:#020617;--nav-hover:#0f172a;--card-shadow:0 1px 3px rgba(0,0,0,.3);
  --hero-gradient:linear-gradient(135deg,#020617 0%,#0f172a 50%,#020617 100%);
}

*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;-webkit-font-smoothing:antialiased;transition:background .3s,color .3s}

/* ── NAV ── */
nav{background:var(--nav);color:#fff;padding:0 1.25rem;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;padding-top:env(safe-area-inset-top,0)}
.brand{font-weight:700;font-size:1.1rem;letter-spacing:-.02em;white-space:nowrap;text-decoration:none;color:#fff}.brand span{color:#60a5fa}
.nav-links{display:flex;gap:.5rem}.nav-links a{color:#94a3b8;text-decoration:none;font-size:.82rem;font-weight:500;padding:.35rem .5rem;border-radius:6px;transition:color .2s}
.nav-links a:hover,.nav-links a.active{color:#fff}
.nav-right{display:flex;align-items:center;gap:.4rem}

/* TOGGLES */
.toggle-btn{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:#94a3b8;padding:.3rem .55rem;border-radius:6px;font-size:.7rem;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s;white-space:nowrap;display:flex;align-items:center;gap:.25rem}
.toggle-btn:hover{color:#fff;background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.2)}
.toggle-btn .icon{font-size:.8rem}

/* CLOCKS */
.nav-clocks{display:flex;gap:.35rem;align-items:center}
.clock-circle{width:48px;height:48px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#1e293b,#0f172a);border:2px solid #334155;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 0 10px rgba(96,165,250,.12),inset 0 1px 2px rgba(0,0,0,.3);position:relative;overflow:hidden}
.clock-circle::before{content:'';position:absolute;top:-1px;left:-1px;right:-1px;bottom:-1px;border-radius:50%;background:conic-gradient(from 0deg,#60a5fa 0%,#3b82f6 25%,#1e40af 50%,#3b82f6 75%,#60a5fa 100%);opacity:.15;z-index:0}
.clock-circle .clock-label{font-size:.38rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:#94a3b8;z-index:1;line-height:1}
.clock-circle .clock-time{font-family:'Courier New',monospace;font-size:.55rem;font-weight:700;color:#60a5fa;z-index:1;line-height:1.2;letter-spacing:.02em}

.today-badge{background:#1e3a5f;color:#93c5fd;font-size:.68rem;padding:3px 8px;border-radius:6px;font-weight:500;white-space:nowrap}
.sign-out-btn{background:none;border:1px solid #334155;color:#94a3b8;padding:.3rem .55rem;border-radius:6px;font-size:.7rem;cursor:pointer;font-family:inherit;transition:all .2s}
.sign-out-btn:hover{color:#fff;border-color:#94a3b8}

.hamburger{display:none;background:none;border:none;color:#fff;font-size:1.4rem;cursor:pointer;padding:.25rem}
.mobile-menu{display:none;position:fixed;top:56px;left:0;right:0;background:var(--nav);padding:.75rem;z-index:99;flex-direction:column;gap:.35rem}
.mobile-menu.open{display:flex}
.mobile-menu a{color:#94a3b8;text-decoration:none;padding:.6rem .75rem;border-radius:8px;font-size:.9rem}
.mobile-menu a:hover,.mobile-menu a.active{color:#fff;background:#1e293b}
.mobile-menu .mobile-toggles{display:flex;gap:.5rem;padding:.6rem .75rem}

/* ── HERO ── */
.hero{background:var(--hero-gradient);padding:3rem 2rem 2.5rem;text-align:center;color:#fff;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(96,165,250,.08) 0%,transparent 70%)}
.hero h1{font-size:2rem;font-weight:700;letter-spacing:-.03em;margin-bottom:.35rem;position:relative;z-index:1}
.hero h1 span{color:#60a5fa}
.hero p{color:#94a3b8;font-size:.95rem;position:relative;z-index:1}

/* ── MODULE CARDS ── */
.container{max-width:1100px;margin:0 auto;padding:2rem 1.25rem 3rem}
.section-label{font-size:.72rem;text-transform:uppercase;letter-spacing:.08em;color:var(--text2);font-weight:700;margin-bottom:.75rem}
.modules-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.module-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:1.5rem;transition:all .25s;cursor:pointer;text-decoration:none;color:inherit;display:flex;flex-direction:column;gap:.75rem;position:relative;overflow:hidden;box-shadow:var(--card-shadow)}
.module-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.1);border-color:var(--accent)}
.module-card.coming-soon{opacity:.6;cursor:default;pointer-events:none}
.module-card.coming-soon:hover{transform:none;box-shadow:var(--card-shadow);border-color:var(--border)}
.module-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.5rem}
.module-icon.blue{background:var(--accent-lt);color:var(--accent)}
.module-icon.green{background:var(--green-bg);color:var(--green)}
.module-icon.purple{background:var(--purple-bg);color:var(--purple)}
.module-icon.orange{background:var(--orange-bg);color:var(--orange)}
.module-title{font-size:1.05rem;font-weight:700;letter-spacing:-.02em}
.module-desc{font-size:.82rem;color:var(--text2);line-height:1.55}
.coming-badge{position:absolute;top:1rem;right:1rem;background:var(--orange-bg);color:var(--orange);font-size:.65rem;font-weight:700;padding:3px 8px;border-radius:6px;text-transform:uppercase;letter-spacing:.04em}
.module-stats{display:flex;gap:1rem;margin-top:.25rem}
.module-stat{font-size:.72rem;color:var(--text2)}
.module-stat strong{color:var(--text);font-weight:600}

/* ── QUICK LINKS ── */
.quick-links{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.25rem}
.quick-link{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .65rem;border:1px solid var(--border);border-radius:6px;font-size:.72rem;font-weight:500;color:var(--text2);text-decoration:none;transition:all .2s;background:var(--card)}
.quick-link:hover{border-color:var(--accent);color:var(--accent)}

/* ── LAST UPDATED ── */
.last-updated-bar{position:fixed;bottom:0;right:0;background:rgba(15,23,42,.85);color:#94a3b8;font-size:.65rem;padding:4px 12px;border-radius:8px 0 0 0;z-index:90;backdrop-filter:blur(8px)}
.last-updated-bar strong{color:#60a5fa;font-weight:600}

/* ── AUTH ── */
.auth-overlay{position:fixed;inset:0;background:#0f172a;display:flex;align-items:center;justify-content:center;z-index:9999}
.auth-overlay.hidden{display:none}
.auth-box{background:rgba(30,41,59,.85);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:3rem 2.5rem;text-align:center;max-width:400px;width:90%}
.auth-title{font-size:1.75rem;color:#fff;font-weight:700}.auth-title span{color:#60a5fa}
.auth-sub{color:#94a3b8;font-size:.9rem;margin:.5rem 0 1.5rem}
.google-btn{display:inline-flex;align-items:center;gap:.6rem;background:#fff;border:none;border-radius:8px;padding:.7rem 1.5rem;font-size:.95rem;font-weight:600;cursor:pointer;font-family:inherit}
.google-btn:hover{background:#f1f5f9}
.auth-error{color:#ef4444;font-size:.85rem;margin-top:1rem;display:none}
.auth-domain{color:#64748b;font-size:.8rem;margin-top:1rem}

/* TOAST */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--nav);color:#fff;padding:.65rem 1rem;border-radius:10px;font-size:.82rem;z-index:300;display:none;box-shadow:0 4px 12px rgba(0,0,0,.2);max-width:380px}
.toast.show{display:block;animation:slideUp .3s ease}
@keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}

/* ── RESPONSIVE ── */
@media(max-width:768px){
  .hamburger{display:block}.nav-links{display:none}.nav-clocks{display:none}.today-badge{display:none}
  .hero h1{font-size:1.5rem}.hero p{font-size:.85rem}.hero{padding:2rem 1rem 1.5rem}
  .modules-grid{grid-template-columns:1fr}
  .toggle-btn .label-text{display:none}
}
@media(min-width:769px){
  .mobile-menu .mobile-toggles{display:none}
}
</style>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>
<body>

<!-- AUTH -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-box">
    <h1 class="auth-title">NF6 <span>Capital</span></h1>
    <p class="auth-sub">HomeBase &mdash; Internal Use Only</p>
    <button class="google-btn" onclick="signInWithGoogle()">
      <svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Sign in with Google
    </button>
    <div class="auth-error" id="authError"></div>
    <p class="auth-domain">Restricted to @nf6capital.com accounts</p>
  </div>
</div>

<!-- NAV -->
<nav>
  <a href="index.html" class="brand">NF6 <span>Capital</span></a>
  <div class="nav-links">
    <a href="index.html" class="active" data-i18n="nav_homebase">HomeBase</a>
    <a href="compliance-dashboard.html" data-i18n="nav_dashboard">Dashboard</a>
    <a href="compliance-calendar.html" data-i18n="nav_calendar">Calendar</a>
    <a href="audit-trail.html" data-i18n="nav_audit">Audit Trail</a>
    <a href="upload.html" data-i18n="nav_upload">Upload</a>
  </div>
  <div class="nav-right">
    <button class="toggle-btn" onclick="toggleLang()" id="langToggle" title="Switch language"><span class="icon">&#127760;</span> <span class="label-text" id="langLabel">ES</span></button>
    <button class="toggle-btn" onclick="toggleTheme()" id="themeToggle" title="Toggle dark/light mode"><span class="icon" id="themeIcon">&#9789;</span> <span class="label-text" id="themeLabel">Dark</span></button>
    <div class="nav-clocks">
      <div class="clock-circle"><span class="clock-label">COL</span><span class="clock-time" id="clockColombia">--:--</span></div>
      <div class="clock-circle"><span class="clock-label">PR</span><span class="clock-time" id="clockPR">--:--</span></div>
    </div>
    <div class="today-badge" id="todayBadge"></div>
    <button class="sign-out-btn" id="signOutBtn" onclick="signOutUser()" style="display:none" data-i18n="nav_signout">Sign Out</button>
  </div>
  <button class="hamburger" onclick="document.getElementById('mm').classList.toggle('open')">&#9776;</button>
</nav>
<div class="mobile-menu" id="mm">
  <a href="index.html" class="active" data-i18n="nav_homebase">HomeBase</a>
  <a href="compliance-dashboard.html" data-i18n="nav_dashboard">Dashboard</a>
  <a href="compliance-calendar.html" data-i18n="nav_calendar">Calendar</a>
  <a href="audit-trail.html" data-i18n="nav_audit">Audit Trail</a>
  <a href="upload.html" data-i18n="nav_upload">Upload</a>
  <div class="mobile-toggles">
    <button class="toggle-btn" onclick="toggleLang()"><span class="icon">&#127760;</span> <span id="langLabelM">ES</span></button>
    <button class="toggle-btn" onclick="toggleTheme()"><span class="icon" id="themeIconM">&#9789;</span> <span id="themeLabelM">Dark</span></button>
  </div>
  <a href="#" onclick="signOutUser();return false" data-i18n="nav_signout">Sign Out</a>
</div>

<!-- HERO -->
<div class="hero">
  <h1>NF6 <span>Capital</span></h1>
  <p data-i18n="hero_subtitle">Internal Operations Hub &mdash; All your tools in one place.</p>
</div>

<!-- MODULES -->
<div class="container">
  <div class="section-label" data-i18n="section_modules">Modules</div>
  <div class="modules-grid">

    <!-- COMPLIANCE CALENDAR -->
    <a href="compliance-dashboard.html" class="module-card" id="complianceCard">
      <div class="module-icon blue">&#128203;</div>
      <div class="module-title" data-i18n="mod_compliance_title">Compliance Calendar</div>
      <div class="module-desc" data-i18n="mod_compliance_desc">Track obligations, due dates, reminders, and audit trails across all entities and locations.</div>
      <div class="module-stats" id="complianceStats">
        <div class="module-stat"><strong id="modTotal">--</strong> items</div>
        <div class="module-stat"><strong id="modOverdue" style="color:var(--red)">--</strong> overdue</div>
        <div class="module-stat"><strong id="modDueSoon" style="color:var(--orange)">--</strong> due soon</div>
      </div>
      <div class="quick-links">
        <span class="quick-link" onclick="event.preventDefault();window.location='compliance-dashboard.html'" data-i18n="nav_dashboard">Dashboard</span>
        <span class="quick-link" onclick="event.preventDefault();window.location='compliance-calendar.html'" data-i18n="nav_calendar">Calendar</span>
        <span class="quick-link" onclick="event.preventDefault();window.location='audit-trail.html'" data-i18n="nav_audit">Audit Trail</span>
        <span class="quick-link" onclick="event.preventDefault();window.location='upload.html'" data-i18n="nav_upload">Upload</span>
      </div>
    </a>

    <!-- FINANCE -->
    <div class="module-card coming-soon">
      <div class="coming-badge" data-i18n="coming_soon">Coming Soon</div>
      <div class="module-icon green">&#128176;</div>
      <div class="module-title" data-i18n="mod_finance_title">Finance</div>
      <div class="module-desc" data-i18n="mod_finance_desc">Financial reporting, budgets, cost forecasting, and expense tracking for all entities.</div>
    </div>

    <!-- DORADO RENTAL PROPERTY -->
    <a href="https://nf6-property-management.onrender.com/" target="_blank" class="module-card">
      <div class="module-icon purple">&#127968;</div>
      <div class="module-title" data-i18n="mod_dorado_title">Dorado Rental Property</div>
      <div class="module-desc" data-i18n="mod_dorado_desc">Manage rental units, tenants, leases, maintenance requests, and property performance.</div>
    </a>

    <!-- DOCUMENT FINDER -->
    <div class="module-card coming-soon">
      <div class="coming-badge" data-i18n="coming_soon">Coming Soon</div>
      <div class="module-icon orange">&#128269;</div>
      <div class="module-title" data-i18n="mod_docfinder_title">Document Finder</div>
      <div class="module-desc" data-i18n="mod_docfinder_desc">Search, organize, and retrieve compliance documents, contracts, and filings across all entities.</div>
    </div>

  </div>
</div>

<div class="last-updated-bar" id="lastUpdated">Last updated: <strong>--</strong></div>
<div class="toast" id="toast"></div>

<script>
// ══════════════════════════════════════
// SHARED: Theme, Language, Clocks, Auth
// ══════════════════════════════════════

// ── I18N ──
const TRANSLATIONS = {
  en: {
    nav_homebase:'HomeBase', nav_dashboard:'Dashboard', nav_calendar:'Calendar',
    nav_audit:'Audit Trail', nav_upload:'Upload', nav_signout:'Sign Out',
    hero_subtitle:'Internal Operations Hub \u2014 All your tools in one place.',
    section_modules:'Modules',
    mod_compliance_title:'Compliance Calendar',
    mod_compliance_desc:'Track obligations, due dates, reminders, and audit trails across all entities and locations.',
    mod_finance_title:'Finance',
    mod_finance_desc:'Financial reporting, budgets, cost forecasting, and expense tracking for all entities.',
    mod_dorado_title:'Dorado Rental Property',
    mod_dorado_desc:'Manage rental units, tenants, leases, maintenance requests, and property performance.',
    mod_docfinder_title:'Document Finder',
    mod_docfinder_desc:'Search, organize, and retrieve compliance documents, contracts, and filings across all entities.',
    coming_soon:'Coming Soon'
  },
  es: {
    nav_homebase:'Inicio', nav_dashboard:'Panel', nav_calendar:'Calendario',
    nav_audit:'Historial', nav_upload:'Cargar', nav_signout:'Cerrar Sesi\u00f3n',
    hero_subtitle:'Centro de Operaciones Internas \u2014 Todas tus herramientas en un solo lugar.',
    section_modules:'M\u00f3dulos',
    mod_compliance_title:'Calendario de Cumplimiento',
    mod_compliance_desc:'Rastree obligaciones, fechas de vencimiento, recordatorios y registros de auditor\u00eda en todas las entidades y ubicaciones.',
    mod_finance_title:'Finanzas',
    mod_finance_desc:'Reportes financieros, presupuestos, pron\u00f3sticos de costos y seguimiento de gastos para todas las entidades.',
    mod_dorado_title:'Propiedad de Alquiler Dorado',
    mod_dorado_desc:'Administre unidades de alquiler, inquilinos, contratos, solicitudes de mantenimiento y rendimiento de propiedades.',
    mod_docfinder_title:'Buscador de Documentos',
    mod_docfinder_desc:'Busque, organice y recupere documentos de cumplimiento, contratos y presentaciones en todas las entidades.',
    coming_soon:'Pr\u00f3ximamente'
  }
};

let currentLang = localStorage.getItem('nf6_lang') || 'en';
let currentTheme = localStorage.getItem('nf6_theme') || 'light';

function applyLang(lang) {
  currentLang = lang;
  localStorage.setItem('nf6_lang', lang);
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) el.textContent = TRANSLATIONS[lang][key];
  });
  // Update toggle labels
  const nextLang = lang === 'en' ? 'ES' : 'EN';
  ['langLabel','langLabelM'].forEach(id => { const e = document.getElementById(id); if(e) e.textContent = nextLang; });
}

function toggleLang() {
  applyLang(currentLang === 'en' ? 'es' : 'en');
}

function applyTheme(theme) {
  currentTheme = theme;
  localStorage.setItem('nf6_theme', theme);
  document.documentElement.setAttribute('data-theme', theme);
  const isDark = theme === 'dark';
  ['themeIcon','themeIconM'].forEach(id => { const e = document.getElementById(id); if(e) e.innerHTML = isDark ? '&#9788;' : '&#9789;'; });
  ['themeLabel','themeLabelM'].forEach(id => { const e = document.getElementById(id); if(e) e.textContent = isDark ? 'Light' : 'Dark'; });
}

function toggleTheme() {
  applyTheme(currentTheme === 'light' ? 'dark' : 'light');
}

// ── CLOCKS ──
function updateClocks() {
  const now = new Date();
  const fmt = (tz) => now.toLocaleTimeString('en-US',{timeZone:tz,hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true});
  const col = document.getElementById('clockColombia');
  const pr = document.getElementById('clockPR');
  if(col) col.textContent = fmt('America/Bogota');
  if(pr) pr.textContent = fmt('America/Puerto_Rico');
}
setInterval(updateClocks, 1000);
updateClocks();

// ── TODAY BADGE ──
function updateTodayBadge() {
  const el = document.getElementById('todayBadge');
  if(!el) return;
  const now = new Date();
  el.textContent = now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
}
updateTodayBadge();

// ── LAST UPDATED ──
function updateLastUpdated() {
  const el = document.getElementById('lastUpdated');
  if(!el) return;
  el.innerHTML = 'Last updated: <strong>' + new Date().toLocaleString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'numeric',minute:'2-digit',hour12:true}) + '</strong>';
}
updateLastUpdated();
setInterval(updateLastUpdated, 60000);

// ── AUTH ──
const FIREBASE_CONFIG = {
  apiKey:"AIzaSyAbvvj4qCzfZPdRxU6BtbRSfXDXPitNwkQ",
  authDomain:"nf6-compliance.firebaseapp.com",
  projectId:"nf6-compliance",
  storageBucket:"nf6-compliance.firebasestorage.app",
  messagingSenderId:"758076256010",
  appId:"1:758076256010:web:5799632950c369244c54f3"
};
const ALLOWED_DOMAIN = 'nf6capital.com';

function initAuth() {
  try {
    firebase.initializeApp(FIREBASE_CONFIG);
    firebase.auth().onAuthStateChanged(user => {
      if(user) {
        if(user.email.split('@')[1] === ALLOWED_DOMAIN) {
          document.getElementById('authOverlay').classList.add('hidden');
          document.getElementById('signOutBtn').style.display = '';
        } else {
          showAuthError('Access restricted to @' + ALLOWED_DOMAIN);
          firebase.auth().signOut();
        }
      } else {
        document.getElementById('authOverlay').classList.remove('hidden');
        document.getElementById('signOutBtn').style.display = 'none';
      }
    });
  } catch(e) { console.warn('Firebase:', e.message); document.getElementById('authOverlay').classList.add('hidden'); }
}
function signInWithGoogle() {
  const p = new firebase.auth.GoogleAuthProvider();
  p.setCustomParameters({hd: ALLOWED_DOMAIN});
  firebase.auth().signInWithPopup(p).catch(e => showAuthError(e.message));
}
function signOutUser() { firebase.auth().signOut(); }
function showAuthError(msg) { const e = document.getElementById('authError'); e.textContent = msg; e.style.display = 'block'; }

// ── COMPLIANCE STATS ON CARD ──
function loadComplianceStats() {
  let data = [];
  try { const s = localStorage.getItem('nf6_compliance_data'); if(s) data = JSON.parse(s); } catch(e){}
  if(!data.length) return;
  const TODAY = new Date(); TODAY.setHours(0,0,0,0);
  function parseDate(str) { if(!str)return null; if(str.includes('-')){const d=new Date(str+'T00:00:00');return isNaN(d)?null:d;} const p=str.split('/'); return p.length===3?new Date(+p[2],+p[0]-1,+p[1]):null; }
  function daysUntil(s) { const d=parseDate(s); return d?Math.ceil((d-TODAY)/864e5):Infinity; }
  const enriched = data.map(d => ({...d, _days: daysUntil(d.nextDue)}));
  document.getElementById('modTotal').textContent = data.length;
  document.getElementById('modOverdue').textContent = enriched.filter(i => i._days < 0).length;
  document.getElementById('modDueSoon').textContent = enriched.filter(i => i._days >= 0 && i._days <= 30).length;
}

// ── INIT ──
initAuth();
applyTheme(currentTheme);
applyLang(currentLang);
loadComplianceStats();
</script>
</body>
</html>
