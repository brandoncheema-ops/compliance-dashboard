<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NF6 Capital - Automobiles</title>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #f5f7fa;
            --card: #fff;
            --border: #e2e8f0;
            --text: #1a202c;
            --text2: #64748b;
            --accent: #2563eb;
            --accent-lt: #eff6ff;
            --green: #16a34a;
            --green-bg: #f0fdf4;
            --yellow: #ca8a04;
            --yellow-bg: #fefce8;
            --red: #dc2626;
            --red-bg: #fef2f2;
            --orange: #ea580c;
            --orange-bg: #fff7ed;
            --purple: #7c3aed;
            --purple-bg: #f5f3ff;
            --nav: #0f172a;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --border: #334155;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --accent: #60a5fa;
            --accent-lt: #1e3a5f;
            --green: #4ade80;
            --green-bg: #064e3b;
            --yellow: #fbbf24;
            --yellow-bg: #713f12;
            --red: #f87171;
            --red-bg: #7f1d1d;
            --orange: #fb923c;
            --orange-bg: #7c2d12;
            --purple: #a78bfa;
            --purple-bg: #4c1d95;
            --nav: #020617;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--nav);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        nav a {
            color: white;
            text-decoration: none;
            transition: color 0.2s;
        }

        nav a:hover {
            color: var(--accent);
        }

        .brand {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brand span {
            color: var(--accent);
            font-style: italic;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            margin-left: 3rem;
        }

        .nav-links a {
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .toggle-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.4rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .hamburger {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .nav-clocks {
            display: flex;
            gap: 1rem;
        }

        .clock-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 0.75rem;
            border-radius: 0.4rem;
        }

        .clock-label {
            font-weight: 600;
            color: var(--accent);
        }

        .clock-time {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }

        .today-badge {
            background: var(--accent);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.4rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .sign-out-btn {
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
            padding: 0.5rem 1rem;
            border-radius: 0.4rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .sign-out-btn:hover {
            background: var(--red);
            color: white;
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text2);
            font-size: 1rem;
        }

        /* Auth Overlay */
        .auth-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            z-index: 1000;
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .auth-card h2 {
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .auth-card p {
            color: var(--text2);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .auth-card button {
            width: 100%;
            padding: 0.75rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .auth-card button:hover {
            opacity: 0.9;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
        }

        .stat-change {
            font-size: 0.8rem;
            color: var(--text2);
            margin-top: 0.5rem;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            position: relative;
        }

        .chart-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Upload Section */
        .upload-section {
            background: var(--card);
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .upload-section.dragover {
            border-color: var(--accent);
            background: var(--accent-lt);
        }

        .upload-section h3 {
            margin-bottom: 1rem;
            color: var(--text);
        }

        .upload-section p {
            color: var(--text2);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .upload-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent);
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--card);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .btn-secondary:hover {
            background: var(--accent-lt);
        }

        .btn-success {
            background: var(--green);
            color: white;
        }

        .btn-success:hover {
            background: var(--green);
            opacity: 0.9;
        }

        .btn-danger {
            background: var(--red);
            color: white;
        }

        .btn-danger:hover {
            background: var(--red);
            opacity: 0.9;
        }

        /* File Input */
        #csvFile {
            display: none;
        }

        /* Data Table */
        .table-section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-header h3 {
            font-size: 1.1rem;
            color: var(--text);
        }

        .filter-row {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            align-items: center;
        }

        .filter-row label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-row select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .filter-row select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-lt);
        }

        .filter-row .clear-filters {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--card);
            color: var(--text2);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-row .clear-filters:hover {
            border-color: var(--red);
            color: var(--red);
        }

        .search-bar {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            min-width: 250px;
        }

        .search-bar input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.95rem;
        }

        .search-bar input::placeholder {
            color: var(--text2);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-lt);
        }

        .table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        thead {
            background: var(--bg);
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            user-select: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        th:hover {
            background: var(--accent-lt);
        }

        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
            font-size: 0.8rem;
        }

        th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        tbody tr:nth-child(even) {
            background: var(--bg);
        }

        tbody tr:hover {
            background: var(--accent-lt);
        }

        td {
            padding: 1rem;
            color: var(--text);
        }

        .status-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 0.4rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: var(--green-bg);
            color: var(--green);
        }

        .status-sold {
            background: var(--red-bg);
            color: var(--red);
        }

        .status-pending {
            background: var(--yellow-bg);
            color: var(--yellow);
        }

        .currency {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
            color: var(--text2);
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .empty-state p {
            max-width: 400px;
            line-height: 1.6;
        }

        /* Detail Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 200;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
            overflow-y: auto;
        }

        .modal.open {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card);
            border-radius: 1rem;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: var(--accent);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 201;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.75rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 2rem;
        }

        .detail-section {
            margin-bottom: 2rem;
        }

        .detail-section h3 {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text2);
            margin-bottom: 1rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .detail-item {
            background: var(--bg);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid var(--accent);
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text);
            font-weight: 500;
            word-break: break-word;
        }

        .detail-value.currency {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            padding: 2rem;
            border-top: 1px solid var(--border);
            background: var(--bg);
            position: sticky;
            bottom: 0;
            z-index: 201;
        }

        .modal-footer button {
            flex: 1;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--text);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 300;
            animation: slideInRight 0.3s;
            max-width: 400px;
        }

        .toast.success {
            background: var(--green);
        }

        .toast.error {
            background: var(--red);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Footer */
        footer {
            background: var(--card);
            border-top: 1px solid var(--border);
            padding: 1.5rem 2rem;
            text-align: center;
            color: var(--text2);
            font-size: 0.9rem;
            margin-top: 3rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .hamburger {
                display: block;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                gap: 1rem;
                width: 100%;
                margin-left: 0;
            }

            .nav-links.open {
                display: flex;
            }

            .nav-controls {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
            }

            .search-bar {
                min-width: 100%;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }

            .modal-content {
                width: 95%;
            }

            .modal-header {
                padding: 1.5rem;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .toast {
                bottom: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .lang-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            margin-right: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- Auth Overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-card">
            <h2>NF6 Capital</h2>
            <p id="authMsg">Sign in with your nf6capital.com account to continue</p>
            <button onclick="signInWithGoogle()">Sign In with Google</button>
        </div>
    </div>

    <!-- Navigation -->
    <nav>
        <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;width:100%">
            <button class="hamburger" onclick="toggleMobileMenu()">‚ò∞</button>
            <a href="index.html" class="brand">NF6 <span>Capital</span></a>
            <div class="nav-links" id="mobileMenu">
                <a href="index.html" data-i18n="homebase">HomeBase</a>
                <a href="compliance-dashboard.html" data-i18n="dashboard">Dashboard</a>
                <a href="compliance-calendar.html" data-i18n="calendar">Calendar</a>
                <a href="audit-trail.html" data-i18n="audit">Audit Trail</a>
                <a href="upload.html" data-i18n="upload">Upload</a>
                <a href="document-finder.html" data-i18n="documents">Documents</a>
            </div>
        </div>
        <div class="nav-controls">
            <button class="toggle-btn" onclick="toggleLanguage()"><span class="lang-dot"></span><span id="langLabel">EN</span></button>
            <button class="toggle-btn" onclick="toggleTheme()">‚òΩ <span id="themeLabel" data-i18n="dark">Dark</span></button>
            <div class="nav-clocks">
                <div class="clock-circle">
                    <span class="clock-label">COL</span>
                    <span class="clock-time" id="clockCOL">--:--:--</span>
                </div>
                <div class="clock-circle">
                    <span class="clock-label">PR</span>
                    <span class="clock-time" id="clockPR">--:--:--</span>
                </div>
            </div>
            <span class="today-badge" id="todayBadge"></span>
            <button class="sign-out-btn" onclick="signOut()" id="signOutBtn">Sign Out</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 data-i18n="pageTitle">Automobiles</h1>
            <p data-i18n="pageSubtitle">Track vehicle details, insurance, registration, and maintenance across all entities.</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
            <h3 data-i18n="uploadData">Upload Vehicle Data</h3>
            <p data-i18n="uploadHint">Drag and drop a CSV file or choose one from your computer</p>
            <div class="upload-buttons">
                <button class="btn btn-primary" onclick="document.getElementById('csvFile').click()" data-i18n="chooseFile">üìÅ Choose CSV File</button>
                <button class="btn btn-secondary" onclick="showSheetsDialog()" data-i18n="googleSheets">üìä Google Sheets URL</button>
                <button class="btn btn-secondary" onclick="exportCSV()" data-i18n="exportCsv">üíæ Export CSV</button>
            </div>
            <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid" style="display: none;">
            <div class="stat-card">
                <div class="stat-label" data-i18n="totalVehicles">Total Vehicles</div>
                <div class="stat-value" id="statTotalVehicles">0</div>
                <div class="stat-change"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="activeVehicles">Active Vehicles</div>
                <div class="stat-value" id="statActiveVehicles">0</div>
                <div class="stat-change"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="totalInsuredValue">Total Insured Value</div>
                <div class="stat-value" id="statTotalValue">$0</div>
                <div class="stat-change"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="expiringSoon">Expiring Soon (30d)</div>
                <div class="stat-value" id="statExpiringSoon">0</div>
                <div class="stat-change"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label" data-i18n="soldVehicles">Sold Vehicles</div>
                <div class="stat-value" id="statSoldVehicles">0</div>
                <div class="stat-change"></div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid" id="chartsGrid" style="display: none;">
            <div class="chart-card">
                <h3 data-i18n="vehiclesByStatus">Vehicles by Status</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 data-i18n="vehiclesByOwner">Vehicles by Owner</h3>
                <div class="chart-container">
                    <canvas id="ownerChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 data-i18n="insuranceCoverage">Insurance Coverage Types</h3>
                <div class="chart-container">
                    <canvas id="coverageChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 data-i18n="purchasePriceChart">Purchase Price by Vehicle</h3>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="table-section" id="tableSection" style="display: none;">
            <div class="table-header">
                <h3 data-i18n="vehicleTable">Vehicle Data</h3>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search vehicles..." data-i18n-placeholder="search" onkeyup="filterTable()">
                </div>
            </div>

            <!-- Filters -->
            <div class="filter-row">
                <label data-i18n="filterBy">Filter By:</label>
                <select id="statusFilter" onchange="filterTable()" data-i18n-placeholder="allStatus">
                    <option value="">All Status</option>
                </select>
                <select id="ownerFilter" onchange="filterTable()" data-i18n-placeholder="allOwners">
                    <option value="">All Owners</option>
                </select>
                <select id="insuranceFilter" onchange="filterTable()" data-i18n-placeholder="allProviders">
                    <option value="">All Insurance Providers</option>
                </select>
                <select id="coverageFilter" onchange="filterTable()" data-i18n-placeholder="allCoverage">
                    <option value="">All Coverage Types</option>
                </select>
                <button class="clear-filters" onclick="clearFilters()" data-i18n="clearFilters">Clear Filters</button>
            </div>

            <!-- Table -->
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead>
                        <tr id="tableHead"></tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <h3 data-i18n="noData">No Data</h3>
                <p data-i18n="uploadCSVFirst">Upload a CSV file to get started.</p>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalVehicleName">Vehicle Details</h2>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()" data-i18n="close">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 NF6 Capital. All rights reserved.</p>
    </footer>

    <script>
        // Firebase Config
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAbvvj4qCzfZPdRxU6BtbRSfXDXPitNwkQ",
            authDomain: "nf6-compliance.firebaseapp.com",
            projectId: "nf6-compliance"
        };

        const ALLOWED_DOMAIN = 'nf6capital.com';

        // Translations
        const translations = {
            en: {
                pageTitle: "Automobiles",
                pageSubtitle: "Track vehicle details, insurance, registration, and maintenance across all entities.",
                uploadData: "Upload Vehicle Data",
                uploadHint: "Drag and drop a CSV file or choose one from your computer",
                chooseFile: "üìÅ Choose CSV File",
                googleSheets: "üìä Google Sheets URL",
                exportCsv: "üíæ Export CSV",
                totalVehicles: "Total Vehicles",
                activeVehicles: "Active Vehicles",
                totalInsuredValue: "Total Insured Value",
                expiringSoon: "Expiring Soon (30d)",
                soldVehicles: "Sold Vehicles",
                vehiclesByStatus: "Vehicles by Status",
                vehiclesByOwner: "Vehicles by Owner",
                insuranceCoverage: "Insurance Coverage Types",
                purchasePriceChart: "Purchase Price by Vehicle",
                vehicleTable: "Vehicle Data",
                search: "Search vehicles...",
                filterBy: "Filter By:",
                allStatus: "All Status",
                allOwners: "All Owners",
                allProviders: "All Insurance Providers",
                allCoverage: "All Coverage Types",
                clearFilters: "Clear Filters",
                noData: "No Data",
                uploadCSVFirst: "Upload a CSV file to get started.",
                close: "Close",
                dark: "Dark",
                homebase: "HomeBase",
                dashboard: "Dashboard",
                calendar: "Calendar",
                audit: "Audit Trail",
                upload: "Upload",
                documents: "Documents"
            },
            es: {
                pageTitle: "Autom√≥viles",
                pageSubtitle: "Rastrear detalles del veh√≠culo, seguros, registraci√≥n y mantenimiento en todas las entidades.",
                uploadData: "Cargar Datos de Veh√≠culos",
                uploadHint: "Arrastra y suelta un archivo CSV o elige uno de tu computadora",
                chooseFile: "üìÅ Elegir Archivo CSV",
                googleSheets: "üìä URL de Google Sheets",
                exportCsv: "üíæ Exportar CSV",
                totalVehicles: "Total de Veh√≠culos",
                activeVehicles: "Veh√≠culos Activos",
                totalInsuredValue: "Valor Total Asegurado",
                expiringSoon: "Expirando Pronto (30d)",
                soldVehicles: "Veh√≠culos Vendidos",
                vehiclesByStatus: "Veh√≠culos por Estado",
                vehiclesByOwner: "Veh√≠culos por Propietario",
                insuranceCoverage: "Tipos de Cobertura de Seguros",
                purchasePriceChart: "Precio de Compra por Veh√≠culo",
                vehicleTable: "Datos de Veh√≠culos",
                search: "Buscar veh√≠culos...",
                filterBy: "Filtrar por:",
                allStatus: "Todos los Estados",
                allOwners: "Todos los Propietarios",
                allProviders: "Todos los Proveedores de Seguros",
                allCoverage: "Todos los Tipos de Cobertura",
                clearFilters: "Limpiar Filtros",
                noData: "Sin Datos",
                uploadCSVFirst: "Carga un archivo CSV para comenzar.",
                close: "Cerrar",
                dark: "Oscuro",
                homebase: "Inicio",
                dashboard: "Panel",
                calendar: "Calendario",
                audit: "Registro de Auditor√≠a",
                upload: "Cargar",
                documents: "Documentos"
            }
        };

        let currentLanguage = localStorage.getItem('nf6_language') || 'en';
        let currentTheme = localStorage.getItem('nf6_theme') || 'light';
        let carsData = [];
        let filteredData = [];
        let charts = {};
        let currentUser = null;

        // Initialize Firebase
        try {
            firebase.initializeApp(FIREBASE_CONFIG);
        } catch (e) {
            console.log('Firebase already initialized');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            updateLanguage();
            initClocks();
            setInterval(updateClocks, 1000);
            setInterval(updateDate, 1000);
            updateDate();
            loadStoredData();
            checkAuth();
        });

        // Auth Functions
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.setCustomParameters({ hd: ALLOWED_DOMAIN });
            firebase.auth().signInWithPopup(provider)
                .catch(e => console.error('Auth error:', e));
        }

        function checkAuth() {
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    const domain = user.email.split('@')[1];
                    if (domain !== ALLOWED_DOMAIN) {
                        firebase.auth().signOut();
                        return;
                    }
                    currentUser = user;
                    document.getElementById('authOverlay').classList.add('hidden');
                    document.getElementById('signOutBtn').style.display = 'block';
                } else {
                    document.getElementById('authOverlay').classList.remove('hidden');
                    document.getElementById('signOutBtn').style.display = 'none';
                }
            });
        }

        function signOut() {
            firebase.auth().signOut();
        }

        // Theme Functions
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';
            if (isDark) {
                html.removeAttribute('data-theme');
                localStorage.setItem('nf6_theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('nf6_theme', 'dark');
            }
        }

        function applyTheme() {
            const theme = localStorage.getItem('nf6_theme') || 'light';
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        // Language Functions
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'es' : 'en';
            localStorage.setItem('nf6_language', currentLanguage);
            updateLanguage();
        }

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = translations[currentLanguage][key] || key;
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = translations[currentLanguage][key] || key;
            });
            document.getElementById('langLabel').textContent = currentLanguage.toUpperCase();
        }

        // Clock Functions
        function updateClocks() {
            const now = new Date();
            const colTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Bogota' }));
            const prTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Puerto_Rico' }));

            const formatTime = (date) => {
                return date.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            };

            document.getElementById('clockCOL').textContent = formatTime(colTime);
            document.getElementById('clockPR').textContent = formatTime(prTime);
        }

        function updateDate() {
            const now = new Date();
            const options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
            document.getElementById('todayBadge').textContent = now.toLocaleDateString('en-US', options);
        }

        // Mobile Menu
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('open');
        }

        // CSV Functions
        function parseCurrency(val) {
            if (!val) return 0;
            const negative = val.startsWith('(') || val.startsWith('-');
            const num = parseFloat(val.replace(/[^0-9.]/g, ''));
            return isNaN(num) ? 0 : (negative ? -num : num);
        }

        function formatCurrency(value) {
            if (typeof value === 'string') {
                value = parseCurrency(value);
            }
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(value);
        }

        function normalizeKeys(data) {
            return data.map(row => {
                const clean = {};
                Object.keys(row).forEach(k => {
                    clean[k.trim()] = row[k];
                });
                return clean;
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: false,
                skipEmptyLines: true,
                complete: (results) => {
                    processCSVData(results.data);
                    showToast('CSV uploaded successfully', 'success');
                },
                error: (err) => showToast('Error parsing CSV: ' + err.message, 'error')
            });
        }

        function processCSVData(rows) {
            // Find the row with "Status" as first column (this is the header row)
            let headerRowIndex = 0;
            for (let i = 0; i < Math.min(rows.length, 10); i++) {
                if (rows[i][0] && rows[i][0].toLowerCase().trim() === 'status') {
                    headerRowIndex = i;
                    break;
                }
            }

            const headers = rows[headerRowIndex];
            const dataRows = rows.slice(headerRowIndex + 1);

            // Filter out empty rows and summary section
            carsData = dataRows
                .filter(row => row[0] && row[0].trim() !== '' && !row[0].toLowerCase().includes('tesla'))
                .map((row, idx) => {
                    const obj = {};
                    headers.forEach((header, colIdx) => {
                        if (header) {
                            obj[header.trim()] = row[colIdx] ? row[colIdx].trim() : '';
                        }
                    });
                    return obj;
                })
                .filter(row => Object.values(row).some(v => v !== ''));

            carsData = normalizeKeys(carsData);

            localStorage.setItem('nf6_cars_data', JSON.stringify(carsData));
            filteredData = [...carsData];
            updateDashboard();
        }

        function loadStoredData() {
            const stored = localStorage.getItem('nf6_cars_data');
            if (stored) {
                carsData = JSON.parse(stored);
                filteredData = [...carsData];
                updateDashboard();
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            const section = document.getElementById('uploadSection');
            section.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('csvFile').files = files;
                handleFileSelect({ target: { files } });
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            document.getElementById('uploadSection').classList.add('dragover');
        }

        function handleDragLeave(e) {
            if (e.target.id === 'uploadSection') {
                document.getElementById('uploadSection').classList.remove('dragover');
            }
        }

        // Dashboard Update
        function updateDashboard() {
            updateStats();
            updateCharts();
            updateTable();
            populateFilters();
            document.getElementById('statsGrid').style.display = 'grid';
            document.getElementById('chartsGrid').style.display = 'grid';
            document.getElementById('tableSection').style.display = 'block';
        }

        function updateStats() {
            const total = carsData.length;
            const active = carsData.filter(row => {
                const status = row['Status'] || '';
                return status.toLowerCase().includes('active');
            }).length;
            const sold = carsData.filter(row => {
                const status = row['Status'] || '';
                return status.toLowerCase().includes('sold');
            }).length;

            let totalValue = 0;
            carsData.forEach(row => {
                const price = row['Purchase Price'] || '';
                totalValue += parseCurrency(price);
            });

            const now = new Date();
            const expiringSoon = carsData.filter(row => {
                const expDate = row['Policy End Date'] || row['Tag expiration date'] || '';
                if (!expDate) return false;
                try {
                    const parts = expDate.split('/');
                    if (parts.length !== 3) return false;
                    const date = new Date(parseInt(parts[2]), parseInt(parts[0]) - 1, parseInt(parts[1]));
                    const daysUntil = (date - now) / (1000 * 60 * 60 * 24);
                    return daysUntil >= 0 && daysUntil <= 30;
                } catch (e) {
                    return false;
                }
            }).length;

            document.getElementById('statTotalVehicles').textContent = total;
            document.getElementById('statActiveVehicles').textContent = active;
            document.getElementById('statTotalValue').textContent = formatCurrency(totalValue);
            document.getElementById('statExpiringSoon').textContent = expiringSoon;
            document.getElementById('statSoldVehicles').textContent = sold;
        }

        function updateCharts() {
            // Status Chart
            const statusCounts = {};
            carsData.forEach(row => {
                const status = row['Status'] || 'Unknown';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });

            if (charts.statusChart) charts.statusChart.destroy();
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            charts.statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: ['#16a34a', '#dc2626', '#ca8a04', '#2563eb', '#7c3aed']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Owner Chart
            const ownerCounts = {};
            carsData.forEach(row => {
                const owner = row['Owner'] || 'Unknown';
                ownerCounts[owner] = (ownerCounts[owner] || 0) + 1;
            });

            if (charts.ownerChart) charts.ownerChart.destroy();
            const ownerCtx = document.getElementById('ownerChart').getContext('2d');
            charts.ownerChart = new Chart(ownerCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(ownerCounts),
                    datasets: [{
                        data: Object.values(ownerCounts),
                        backgroundColor: ['#2563eb', '#7c3aed', '#0891b2', '#ea580c', '#f59e0b']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Coverage Chart
            const coverageCounts = {};
            carsData.forEach(row => {
                const coverage = row['Coverage Type'] || 'Unknown';
                if (coverage) {
                    coverageCounts[coverage] = (coverageCounts[coverage] || 0) + 1;
                }
            });

            if (charts.coverageChart) charts.coverageChart.destroy();
            const coverageCtx = document.getElementById('coverageChart').getContext('2d');
            charts.coverageChart = new Chart(coverageCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(coverageCounts),
                    datasets: [{
                        data: Object.values(coverageCounts),
                        backgroundColor: ['#16a34a', '#2563eb', '#7c3aed', '#f59e0b']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Price Chart
            const priceData = carsData.map(row => ({
                vehicle: row['Vehicle'] || 'Unknown',
                price: parseCurrency(row['Purchase Price'] || '0')
            })).filter(x => x.price > 0);

            if (charts.priceChart) charts.priceChart.destroy();
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            charts.priceChart = new Chart(priceCtx, {
                type: 'bar',
                data: {
                    labels: priceData.map(x => x.vehicle),
                    datasets: [{
                        label: 'Purchase Price',
                        data: priceData.map(x => x.price),
                        backgroundColor: '#2563eb'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function populateFilters() {
            const statuses = [...new Set(carsData.map(row => row['Status'] || 'Unknown'))];
            const owners = [...new Set(carsData.map(row => row['Owner'] || 'Unknown'))];
            const insurers = [...new Set(carsData.map(row => row['Insurance Provider'] || 'Unknown').filter(x => x))];
            const coverages = [...new Set(carsData.map(row => row['Coverage Type'] || 'Unknown').filter(x => x))];

            const statusSelect = document.getElementById('statusFilter');
            statuses.forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                statusSelect.appendChild(option);
            });

            const ownerSelect = document.getElementById('ownerFilter');
            owners.forEach(owner => {
                const option = document.createElement('option');
                option.value = owner;
                option.textContent = owner;
                ownerSelect.appendChild(option);
            });

            const insurerSelect = document.getElementById('insuranceFilter');
            insurers.forEach(insurer => {
                const option = document.createElement('option');
                option.value = insurer;
                option.textContent = insurer;
                insurerSelect.appendChild(option);
            });

            const coverageSelect = document.getElementById('coverageFilter');
            coverages.forEach(coverage => {
                const option = document.createElement('option');
                option.value = coverage;
                option.textContent = coverage;
                coverageSelect.appendChild(option);
            });
        }

        function updateTable() {
            if (filteredData.length === 0) {
                document.getElementById('emptyState').style.display = 'flex';
                document.getElementById('tableBody').innerHTML = '';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';

            // Create header
            const columns = ['Vehicle', 'Year', 'Status', 'Owner', 'Purchase Price', 'Insurance Provider', 'Policy End Date', 'Premium', 'Tag expiration date'];
            const thead = document.getElementById('tableHead');
            thead.innerHTML = '';
            columns.forEach(col => {
                const th = document.createElement('th');
                th.className = 'sortable';
                th.textContent = col;
                th.onclick = () => sortTable(col);
                thead.appendChild(th);
            });

            // Create rows
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            filteredData.forEach((row, idx) => {
                const tr = document.createElement('tr');
                tr.onclick = () => openModal(row);

                columns.forEach(col => {
                    const td = document.createElement('td');
                    let value = row[col] || '-';

                    if (col === 'Status') {
                        const badge = document.createElement('span');
                        badge.className = 'status-badge status-' + value.toLowerCase().replace(' ', '-');
                        badge.textContent = value;
                        td.appendChild(badge);
                    } else if (col === 'Purchase Price' || col === 'Premium') {
                        td.className = 'currency';
                        td.textContent = value !== '-' ? formatCurrency(value) : '-';
                    } else {
                        td.textContent = value;
                    }

                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });
        }

        function filterTable() {
            const status = document.getElementById('statusFilter').value;
            const owner = document.getElementById('ownerFilter').value;
            const insurance = document.getElementById('insuranceFilter').value;
            const coverage = document.getElementById('coverageFilter').value;
            const search = document.getElementById('searchInput').value.toLowerCase();

            filteredData = carsData.filter(row => {
                const matchStatus = !status || row['Status'] === status;
                const matchOwner = !owner || row['Owner'] === owner;
                const matchInsurance = !insurance || row['Insurance Provider'] === insurance;
                const matchCoverage = !coverage || row['Coverage Type'] === coverage;
                const matchSearch = !search ||
                    (row['Vehicle'] && row['Vehicle'].toLowerCase().includes(search)) ||
                    (row['VIN'] && row['VIN'].toLowerCase().includes(search)) ||
                    (row['License plate'] && row['License plate'].toLowerCase().includes(search));

                return matchStatus && matchOwner && matchInsurance && matchCoverage && matchSearch;
            });

            updateTable();
        }

        function clearFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('ownerFilter').value = '';
            document.getElementById('insuranceFilter').value = '';
            document.getElementById('coverageFilter').value = '';
            document.getElementById('searchInput').value = '';
            filteredData = [...carsData];
            updateTable();
        }

        function sortTable(col) {
            const isAsc = document.querySelector(`th[data-sort="${col}"]`) ?
                         document.querySelector(`th[data-sort="${col}"]`).classList.contains('sorted-asc') : true;

            filteredData.sort((a, b) => {
                let aVal = a[col] || '';
                let bVal = b[col] || '';

                if (col === 'Purchase Price' || col === 'Premium') {
                    aVal = parseCurrency(aVal);
                    bVal = parseCurrency(bVal);
                    return isAsc ? bVal - aVal : aVal - bVal;
                }

                aVal = aVal.toString().toLowerCase();
                bVal = bVal.toString().toLowerCase();
                return isAsc ? bVal.localeCompare(aVal) : aVal.localeCompare(bVal);
            });

            updateTable();
        }

        function openModal(row) {
            const modal = document.getElementById('detailModal');
            document.getElementById('modalVehicleName').textContent = row['Vehicle'] || 'Vehicle Details';

            let html = '';

            // Vehicle Section
            html += '<div class="detail-section">';
            html += '<h3>Vehicle Information</h3>';
            html += '<div class="detail-grid">';
            ['Vehicle', 'Year', 'Status', 'VIN', 'Miles', 'Owner', 'License plate', 'Purchase Price'].forEach(key => {
                if (row[key]) {
                    html += '<div class="detail-item">';
                    html += '<div class="detail-label">' + key + '</div>';
                    if (key === 'Purchase Price') {
                        html += '<div class="detail-value currency">' + formatCurrency(row[key]) + '</div>';
                    } else {
                        html += '<div class="detail-value">' + row[key] + '</div>';
                    }
                    html += '</div>';
                }
            });
            html += '</div></div>';

            // Insurance Section
            html += '<div class="detail-section">';
            html += '<h3>Insurance Information</h3>';
            html += '<div class="detail-grid">';
            ['Insurance Provider', 'Policy Number', 'Coverage Type', 'Policy Start Date', 'Policy End Date', 'Premium', 'Renewal date'].forEach(key => {
                if (row[key]) {
                    html += '<div class="detail-item">';
                    html += '<div class="detail-label">' + key + '</div>';
                    if (key === 'Premium') {
                        html += '<div class="detail-value currency">' + formatCurrency(row[key]) + '</div>';
                    } else {
                        html += '<div class="detail-value">' + row[key] + '</div>';
                    }
                    html += '</div>';
                }
            });
            html += '</div></div>';

            // Registration Section
            html += '<div class="detail-section">';
            html += '<h3>Registration Information</h3>';
            html += '<div class="detail-grid">';
            ['Tag Number', 'Tag expiration date'].forEach(key => {
                if (row[key]) {
                    html += '<div class="detail-item">';
                    html += '<div class="detail-label">' + key + '</div>';
                    html += '<div class="detail-value">' + row[key] + '</div>';
                    html += '</div>';
                }
            });
            html += '</div></div>';

            // Links Section
            html += '<div class="detail-section">';
            html += '<h3>Links</h3>';
            html += '<div class="detail-grid">';
            ['Main folder', 'Insurance', 'Resgistration'].forEach(key => {
                if (row[key]) {
                    html += '<div class="detail-item">';
                    html += '<div class="detail-label">' + key + '</div>';
                    html += '<div class="detail-value">' + row[key] + '</div>';
                    html += '</div>';
                }
            });
            html += '</div></div>';

            document.getElementById('modalBody').innerHTML = html;
            modal.classList.add('open');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('open');
        }

        function exportCSV() {
            if (carsData.length === 0) {
                showToast('No data to export', 'error');
                return;
            }

            const headers = Object.keys(carsData[0]);
            let csv = headers.join(',') + '\n';
            carsData.forEach(row => {
                csv += headers.map(h => {
                    const val = row[h] || '';
                    return val.includes(',') ? '"' + val + '"' : val;
                }).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'vehicles_' + new Date().toISOString().slice(0, 10) + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            showToast('CSV exported successfully', 'success');
        }

        function showSheetsDialog() {
            const url = prompt('Enter Google Sheets URL:');
            if (url) {
                localStorage.setItem('nf6_sheets_url_cars', url);
                showToast('Google Sheets URL saved', 'success');
            }
        }

        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
