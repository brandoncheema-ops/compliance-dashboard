<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NF6 Capital - Assets Dashboard</title>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #f5f7fa;
            --card: #fff;
            --border: #e2e8f0;
            --text: #1a202c;
            --text2: #64748b;
            --accent: #2563eb;
            --accent-lt: #eff6ff;
            --green: #16a34a;
            --green-bg: #f0fdf4;
            --yellow: #ca8a04;
            --yellow-bg: #fefce8;
            --red: #dc2626;
            --red-bg: #fef2f2;
            --orange: #ea580c;
            --orange-bg: #fff7ed;
            --purple: #7c3aed;
            --purple-bg: #f5f3ff;
            --nav: #0f172a;
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --border: #334155;
            --text: #e2e8f0;
            --text2: #94a3b8;
            --accent: #60a5fa;
            --accent-lt: #1e3a5f;
            --green: #4ade80;
            --green-bg: #064e3b;
            --yellow: #fbbf24;
            --yellow-bg: #713f12;
            --red: #f87171;
            --red-bg: #7f1d1d;
            --orange: #fb923c;
            --orange-bg: #7c2d12;
            --purple: #a78bfa;
            --purple-bg: #4c1d95;
            --nav: #020617;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Navigation */
        nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--nav);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .brand span {
            color: var(--accent);
            font-style: italic;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            margin-left: 3rem;
        }

        .nav-links a {
            font-size: 0.95rem;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--accent);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .toggle-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.4rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .hamburger {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .nav-clocks {
            display: flex;
            gap: 1rem;
        }

        .clock-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 0.75rem;
            border-radius: 0.4rem;
        }

        .clock-label {
            font-weight: 600;
            color: var(--accent);
        }

        .clock-time {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.7rem;
            margin-top: 0.25rem;
        }

        .today-badge {
            background: var(--accent);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.4rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .sign-out-btn {
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
            padding: 0.5rem 1rem;
            border-radius: 0.4rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .sign-out-btn:hover {
            background: var(--red);
            color: white;
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text2);
            font-size: 1rem;
        }

        /* Auth Overlay */
        .auth-overlay {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            z-index: 1000;
        }

        .auth-overlay.hidden {
            display: none;
        }

        .auth-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 3rem;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .auth-card h2 {
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .auth-card p {
            color: var(--text2);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        #firebaseui-auth-container {
            display: flex;
            justify-content: center;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text);
        }

        .stat-change {
            font-size: 0.8rem;
            color: var(--green);
            margin-top: 0.5rem;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            position: relative;
        }

        .chart-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Upload Section */
        .upload-section {
            background: var(--card);
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .upload-section.dragover {
            border-color: var(--accent);
            background: var(--accent-lt);
        }

        .upload-section h3 {
            margin-bottom: 1rem;
            color: var(--text);
        }

        .upload-section p {
            color: var(--text2);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .upload-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent);
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--card);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .btn-secondary:hover {
            background: var(--accent-lt);
        }

        .btn-success {
            background: var(--green);
            color: white;
        }

        .btn-success:hover {
            background: var(--green);
            opacity: 0.9;
        }

        .btn-danger {
            background: var(--red);
            color: white;
        }

        .btn-danger:hover {
            background: var(--red);
            opacity: 0.9;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* File Input */
        #csvFile, #sheetsUrl {
            display: none;
        }

        /* Data Table */
        .table-section {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-header h3 {
            font-size: 1.1rem;
            color: var(--text);
        }

        .filter-row {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
            align-items: center;
        }

        .filter-row label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-row select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            min-width: 140px;
        }

        .filter-row select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-lt);
        }

        .filter-row .clear-filters {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--card);
            color: var(--text2);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-row .clear-filters:hover {
            border-color: var(--red);
            color: var(--red);
        }

        .search-bar {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            min-width: 250px;
        }

        .search-bar input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 0.95rem;
        }

        .search-bar input::placeholder {
            color: var(--text2);
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-lt);
        }

        .table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        thead {
            background: var(--bg);
            border-bottom: 2px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text);
            user-select: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        th:hover {
            background: var(--accent-lt);
        }

        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
            font-size: 0.8rem;
        }

        th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        tbody tr:nth-child(even) {
            background: var(--bg);
        }

        tbody tr:hover {
            background: var(--accent-lt);
        }

        td {
            padding: 1rem;
            color: var(--text);
        }

        .status-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 0.4rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: var(--green-bg);
            color: var(--green);
        }

        .status-sold {
            background: var(--orange-bg);
            color: var(--orange);
        }

        .status-dissolved {
            background: var(--red-bg);
            color: var(--red);
        }

        .status-written-off {
            background: #e5e7eb;
            color: #6b7280;
        }

        .currency {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .percentage {
            color: var(--green);
            font-weight: 600;
        }

        .percentage.negative {
            color: var(--red);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
            color: var(--text2);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .empty-state p {
            max-width: 400px;
            line-height: 1.6;
        }

        /* Detail Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 200;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
            overflow-y: auto;
        }

        .modal.open {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card);
            border-radius: 1rem;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: var(--accent);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 201;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.75rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 2rem;
        }

        .detail-section {
            margin-bottom: 2rem;
        }

        .detail-section h3 {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text2);
            margin-bottom: 1rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .detail-item {
            background: var(--bg);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid var(--accent);
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .detail-value {
            font-size: 1rem;
            color: var(--text);
            font-weight: 500;
            word-break: break-word;
        }

        .detail-value.currency {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.95rem;
        }

        .links-list {
            list-style: none;
            margin: 1rem 0;
        }

        .links-list li {
            margin-bottom: 0.5rem;
        }

        .links-list a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .links-list a:hover {
            text-decoration: underline;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            padding: 2rem;
            border-top: 1px solid var(--border);
            background: var(--bg);
            position: sticky;
            bottom: 0;
            z-index: 201;
        }

        .modal-footer button {
            flex: 1;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--text);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 300;
            animation: slideInRight 0.3s;
            max-width: 400px;
        }

        .toast.success {
            background: var(--green);
        }

        .toast.error {
            background: var(--red);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Footer */
        footer {
            background: var(--card);
            border-top: 1px solid var(--border);
            padding: 1.5rem 2rem;
            text-align: center;
            color: var(--text2);
            font-size: 0.9rem;
            margin-top: 3rem;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            nav {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .hamburger {
                display: block;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                gap: 1rem;
                width: 100%;
                margin-left: 0;
            }

            .nav-links.open {
                display: flex;
            }

            .nav-right {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
            }

            .search-bar {
                min-width: 100%;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }

            .modal-content {
                width: 95%;
            }

            .modal-header {
                padding: 1.5rem;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .modal-body {
                padding: 1.5rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .toast {
                bottom: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Auth Overlay -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-card">
            <h2>NF6 Capital</h2>
            <p>Sign in with your nf6capital.com account to continue</p>
            <div id="firebaseui-auth-container"></div>
        </div>
    </div>

    <!-- Navigation -->
    <nav>
        <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;width:100%">
            <button class="hamburger" onclick="toggleMobileMenu()">‚ò∞</button>
            <a href="index.html" class="brand">NF6 <span>Capital</span></a>
            <div class="nav-links" id="mobileMenu">
                <a href="index.html">HomeBase</a>
                <a href="compliance-dashboard.html">Dashboard</a>
                <a href="compliance-calendar.html">Calendar</a>
                <a href="audit-trail.html">Audit Trail</a>
                <a href="upload.html">Upload</a>
                <a href="document-finder.html">Documents</a>
            </div>
        </div>
        <div class="nav-right">
            <button class="toggle-btn" onclick="toggleLang()">‚óè <span id="langLabel">ES</span></button>
            <button class="toggle-btn" onclick="toggleTheme()">‚òΩ Dark</button>
            <div class="nav-clocks">
                <div class="clock-circle">
                    <span class="clock-label">COL</span>
                    <span class="clock-time" id="clockCOL">--:--:--</span>
                </div>
                <div class="clock-circle">
                    <span class="clock-label">PR</span>
                    <span class="clock-time" id="clockPR">--:--:--</span>
                </div>
            </div>
            <span class="today-badge" id="todayBadge"></span>
            <button class="sign-out-btn" onclick="signOut()">Sign Out</button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>Assets Dashboard</h1>
            <p>Manage and track your capital assets across all locations</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
            <h3>üìä Upload Data or Sync from Google Sheets</h3>
            <p>Drag and drop a CSV file, or choose from the options below</p>
            <div class="upload-buttons">
                <button class="btn btn-primary" onclick="document.getElementById('csvFile').click()">üìÅ Choose CSV File</button>
                <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
                <button class="btn btn-secondary" onclick="showSheetsDialog()">üìä Google Sheets URL</button>
                <button class="btn btn-secondary" onclick="exportCSV()">üíæ Export CSV</button>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid" style="display: none;">
            <div class="stat-card">
                <div class="stat-label">Total Assets</div>
                <div class="stat-value" id="statTotalAssets">0</div>
                <div class="stat-change" id="statTotalAssetsChange"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Capital Invested</div>
                <div class="stat-value" id="statTotalCapital">$0</div>
                <div class="stat-change" id="statTotalCapitalChange"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Active Assets</div>
                <div class="stat-value" id="statActiveAssets">0</div>
                <div class="stat-change" id="statActiveAssetsChange"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Distributions</div>
                <div class="stat-value" id="statTotalDistributions">$0</div>
                <div class="stat-change" id="statTotalDistributionsChange"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Average ROI %</div>
                <div class="stat-value" id="statAverageROI">0%</div>
                <div class="stat-change" id="statAverageROIChange"></div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid" id="chartsGrid" style="display: none;">
            <div class="chart-card">
                <h3>Assets by Category</h3>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Assets by Status</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Capital Invested by Location</h3>
                <div class="chart-container">
                    <canvas id="locationChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3>Top 10 Assets by Investment</h3>
                <div class="chart-container">
                    <canvas id="topAssetsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table Section -->
        <div class="table-section" id="tableSection" style="display: none;">
            <div class="table-header">
                <h3 data-i18n="assetPortfolio">Asset Portfolio</h3>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search assets..." data-i18n-placeholder="searchAssets" onkeyup="applyFilters()">
                </div>
            </div>
            <div class="filter-row" id="filterRow">
                <label data-i18n="filters">Filters:</label>
                <select id="filterCategory" onchange="applyFilters()">
                    <option value="">All Categories</option>
                </select>
                <select id="filterStatus" onchange="applyFilters()">
                    <option value="">All Statuses</option>
                </select>
                <select id="filterLocation" onchange="applyFilters()">
                    <option value="">All Locations</option>
                </select>
                <select id="filterOwner" onchange="applyFilters()">
                    <option value="">All Owners</option>
                </select>
                <button class="clear-filters" onclick="clearFilters()" data-i18n="clearFilters">Clear Filters</button>
            </div>
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('Asset')">Asset</th>
                            <th class="sortable" onclick="sortTable('Location')">Location</th>
                            <th class="sortable" onclick="sortTable('Category')">Category</th>
                            <th class="sortable" onclick="sortTable('Status')">Status</th>
                            <th class="sortable" onclick="sortTable('Owner')">Owner</th>
                            <th>% Owned</th>
                            <th class="sortable" onclick="sortTable('Initial investment')">Initial Investment</th>
                            <th class="sortable" onclick="sortTable('Total Capital Invested')">Total Capital</th>
                            <th class="sortable" onclick="sortTable('Net profit')">Net Profit</th>
                            <th class="sortable" onclick="sortTable('ROI % on cash distributions')">ROI %</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState">
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="30" r="20" fill="currentColor"/>
                <path d="M 20 60 Q 20 70 30 75 L 70 75 Q 80 70 80 60" fill="currentColor"/>
            </svg>
            <h3>No Data Yet</h3>
            <p>Upload a CSV file or sync from Google Sheets to get started with your assets dashboard</p>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalAssetName"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Description -->
                <div class="detail-section">
                    <h3>Description</h3>
                    <p id="modalDescription" style="color: var(--text2); line-height: 1.6;"></p>
                </div>

                <!-- Key Metrics -->
                <div class="detail-section">
                    <h3>Key Metrics</h3>
                    <div class="detail-grid" id="modalMetrics"></div>
                </div>

                <!-- Investment Details -->
                <div class="detail-section">
                    <h3>Investment Details</h3>
                    <div class="detail-grid" id="modalInvestment"></div>
                </div>

                <!-- Ownership & Location -->
                <div class="detail-section">
                    <h3>Ownership & Location</h3>
                    <div class="detail-grid" id="modalOwnership"></div>
                </div>

                <!-- Timeline -->
                <div class="detail-section">
                    <h3>Timeline</h3>
                    <div class="detail-grid" id="modalTimeline"></div>
                </div>

                <!-- Documents & Links -->
                <div class="detail-section">
                    <h3>Documents & Links</h3>
                    <div id="modalLinks"></div>
                </div>

                <!-- Tax & Accounting -->
                <div class="detail-section">
                    <h3>Tax & Accounting</h3>
                    <div class="detail-grid" id="modalTax"></div>
                </div>

                <!-- Additional Notes -->
                <div class="detail-section">
                    <h3>Additional Notes</h3>
                    <div class="detail-grid" id="modalNotes"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Close</button>
                <button class="btn btn-danger btn-sm" onclick="deleteAsset()" style="flex: 0;">Delete Asset</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>NF6 Capital Assets Dashboard | Last updated: <span id="lastUpdated">Never</span></p>
    </footer>

    <script>
        // ===============================
        // CONFIG & INITIALIZATION
        // ===============================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyAbvvj4qCzfZPdRxU6BtbRSfXDXPitNwkQ",
            authDomain: "nf6-compliance.firebaseapp.com",
            projectId: "nf6-compliance"
        };
        const ALLOWED_DOMAIN = 'nf6capital.com';
        const STORAGE_KEY = 'nf6_assets_data';
        const SHEETS_KEY = 'nf6_sheets_url_assets';

        let assetData = [];

        // Trim trailing spaces from all CSV column names
        function normalizeKeys(data) {
            return data.map(row => {
                const clean = {};
                Object.keys(row).forEach(k => { clean[k.trim()] = row[k]; });
                return clean;
            });
        }
        let filteredData = [];
        let sortColumn = 'Asset';
        let sortDirection = 'asc';
        let charts = {};
        let currentUser = null;

        // Initialize Firebase
        try {
            firebase.initializeApp(FIREBASE_CONFIG);
        } catch (error) {
            console.log('Firebase already initialized');
        }

        const auth = firebase.auth();

        // ===============================
        // AUTH
        // ===============================
        function initAuth() {
            auth.onAuthStateChanged((user) => {
                if (user && user.email && user.email.endsWith('@' + ALLOWED_DOMAIN)) {
                    currentUser = user;
                    document.getElementById('authOverlay').classList.add('hidden');
                    initApp();
                } else if (user) {
                    signOut();
                    showToast('Error: Please sign in with an ' + ALLOWED_DOMAIN + ' account', 'error');
                } else {
                    document.getElementById('authOverlay').classList.remove('hidden');
                    showGoogleSignIn();
                }
            });
        }

        function showGoogleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            provider.setCustomParameters({ hd: ALLOWED_DOMAIN });

            const signInBtn = document.createElement('button');
            signInBtn.className = 'btn btn-primary';
            signInBtn.textContent = 'Sign In with Google';
            signInBtn.onclick = () => {
                auth.signInWithPopup(provider).catch(error => {
                    showToast('Authentication failed: ' + error.message, 'error');
                });
            };

            const container = document.getElementById('firebaseui-auth-container');
            container.innerHTML = '';
            container.appendChild(signInBtn);
        }

        function signOut() {
            auth.signOut().then(() => {
                currentUser = null;
                document.getElementById('authOverlay').classList.remove('hidden');
            });
        }

        // ===============================
        // APP INITIALIZATION
        // ===============================
        function initApp() {
            loadData();
            initClocks();
            initTheme();
            initLanguage();
            loadSheetsUrlIfExists();
        }

        function loadData() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    assetData = normalizeKeys(JSON.parse(stored));
                    renderDashboard();
                } catch (error) {
                    console.error('Error loading data:', error);
                    showToast('Error loading saved data', 'error');
                }
            }
        }

        // ===============================
        // CSV HANDLING
        // ===============================
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    if (results.data && results.data.length > 0) {
                        assetData = normalizeKeys(results.data);
                        saveData();
                        renderDashboard();
                        showToast(`Loaded ${assetData.length} assets successfully`, 'success');
                    } else {
                        showToast('CSV file is empty', 'error');
                    }
                },
                error: (error) => {
                    showToast('Error parsing CSV: ' + error.message, 'error');
                }
            });

            event.target.value = '';
        }

        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('uploadSection').classList.remove('dragover');

            const files = event.dataTransfer.files;
            if (files.length > 0 && (files[0].type === 'text/csv' || files[0].name.endsWith('.csv'))) {
                const file = files[0];
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        if (results.data && results.data.length > 0) {
                            assetData = normalizeKeys(results.data);
                            saveData();
                            renderDashboard();
                            showToast(`Loaded ${assetData.length} assets successfully`, 'success');
                        }
                    },
                    error: (error) => {
                        showToast('Error parsing CSV: ' + error.message, 'error');
                    }
                });
            } else {
                showToast('Please drop a CSV file', 'error');
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            document.getElementById('uploadSection').classList.add('dragover');
        }

        function handleDragLeave(event) {
            if (event.target.id === 'uploadSection') {
                document.getElementById('uploadSection').classList.remove('dragover');
            }
        }

        // ===============================
        // GOOGLE SHEETS
        // ===============================
        function showSheetsDialog() {
            const url = prompt('Enter Google Sheets CSV export URL (https://docs.google.com/spreadsheets/d/...export?format=csv)');
            if (url) {
                localStorage.setItem(SHEETS_KEY, url);
                loadFromSheets(url);
            }
        }

        function loadFromSheets(url) {
            fetch(url)
                .then(response => response.text())
                .then(csv => {
                    Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            if (results.data && results.data.length > 0) {
                                assetData = normalizeKeys(results.data);
                                saveData();
                                renderDashboard();
                                showToast(`Synced ${assetData.length} assets from Google Sheets`, 'success');
                                updateLastUpdated();
                            }
                        },
                        error: (error) => {
                            showToast('Error parsing Google Sheets: ' + error.message, 'error');
                        }
                    });
                })
                .catch(error => {
                    showToast('Error fetching Google Sheets: ' + error.message, 'error');
                });
        }

        function loadSheetsUrlIfExists() {
            const url = localStorage.getItem(SHEETS_KEY);
            if (url) {
                loadFromSheets(url);
            }
        }

        // ===============================
        // DATA PERSISTENCE
        // ===============================
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(assetData));
                updateLastUpdated();
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('Error saving data', 'error');
            }
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleString();
            localStorage.setItem('nf6_assets_lastUpdated', now.toISOString());
        }

        // ===============================
        // CURRENCY PARSING
        // ===============================
        function parseCurrency(value) {
            if (!value || value === 'N/A' || value === '#VALUE!' || value === '') return 0;

            if (typeof value === 'string' && value.includes('%')) return 0;

            if (typeof value === 'string') {
                value = value.replace(/[$,]/g, '');

                if (value.includes('(') && value.includes(')')) {
                    value = '-' + value.replace(/[()]/g, '');
                }

                const num = parseFloat(value);
                return isNaN(num) ? 0 : num;
            }

            return typeof value === 'number' ? value : 0;
        }

        function formatCurrency(value) {
            const num = parseCurrency(value);
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(num);
        }

        function parsePercentage(value) {
            if (!value || value === 'N/A' || value === '#VALUE!' || value === '') return 0;

            if (typeof value === 'string') {
                value = value.replace('%', '').trim();
                const num = parseFloat(value);
                return isNaN(num) ? 0 : num;
            }

            return typeof value === 'number' ? value : 0;
        }

        // ===============================
        // DASHBOARD RENDERING
        // ===============================
        function renderDashboard() {
            if (assetData.length === 0) {
                document.getElementById('emptyState').style.display = 'flex';
                document.getElementById('statsGrid').style.display = 'none';
                document.getElementById('chartsGrid').style.display = 'none';
                document.getElementById('tableSection').style.display = 'none';
                document.getElementById('uploadSection').style.display = 'block';
                return;
            }

            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('statsGrid').style.display = 'grid';
            document.getElementById('chartsGrid').style.display = 'grid';
            document.getElementById('tableSection').style.display = 'block';
            document.getElementById('uploadSection').style.display = 'block';

            renderStats();
            renderCharts();
            populateFilters();
            renderTable();
        }

        function renderStats() {
            const totalAssets = assetData.length;
            const activeAssets = assetData.filter(a => a.Status === 'Active').length;
            const totalCapital = assetData.reduce((sum, a) => sum + parseCurrency(a['Total Capital Invested']), 0);
            const totalDistributions = assetData.reduce((sum, a) => sum + parseCurrency(a['Distributions received total']), 0);

            const roiValues = assetData
                .map(a => parsePercentage(a['ROI % on cash distributions']))
                .filter(r => r !== 0);
            const avgROI = roiValues.length > 0 ? (roiValues.reduce((a, b) => a + b, 0) / roiValues.length).toFixed(2) : 0;

            document.getElementById('statTotalAssets').textContent = totalAssets;
            document.getElementById('statActiveAssets').textContent = activeAssets;
            document.getElementById('statTotalCapital').textContent = formatCurrency(totalCapital);
            document.getElementById('statTotalDistributions').textContent = formatCurrency(totalDistributions);
            document.getElementById('statAverageROI').textContent = avgROI + '%';
        }

        function renderCharts() {
            destroyCharts();

            // Category Chart
            const categoryCounts = {};
            const categoryColors = {
                'Real Estate': '#3b82f6',
                'Business Asset': '#8b5cf6',
                'Other Asset': '#ec4899'
            };

            assetData.forEach(a => {
                const cat = a.Category || 'Unknown';
                categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
            });

            charts.categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: Object.keys(categoryCounts).map(cat => categoryColors[cat] || '#6b7280'),
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text') }
                        }
                    }
                }
            });

            // Status Chart
            const statusCounts = {};
            const statusColors = {
                'Active': '#16a34a',
                'Sold': '#ea580c',
                'Dissolved': '#dc2626',
                'Written Off': '#9ca3af'
            };

            assetData.forEach(a => {
                const status = a.Status || 'Unknown';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });

            charts.statusChart = new Chart(document.getElementById('statusChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(statusCounts),
                    datasets: [{
                        data: Object.values(statusCounts),
                        backgroundColor: Object.keys(statusCounts).map(status => statusColors[status] || '#6b7280'),
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text') }
                        }
                    }
                }
            });

            // Location Chart
            const locationCapital = {};
            assetData.forEach(a => {
                const loc = a.Location || 'Unknown';
                locationCapital[loc] = (locationCapital[loc] || 0) + parseCurrency(a['Total Capital Invested']);
            });

            const sortedLocations = Object.entries(locationCapital)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            charts.locationChart = new Chart(document.getElementById('locationChart'), {
                type: 'bar',
                data: {
                    labels: sortedLocations.map(l => l[0]),
                    datasets: [{
                        label: 'Capital Invested',
                        data: sortedLocations.map(l => l[1]),
                        backgroundColor: '#3b82f6',
                        borderColor: '#1e40af',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text') }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text2') }
                        },
                        y: {
                            ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text2') }
                        }
                    }
                }
            });

            // Top Assets Chart
            const sortedAssets = assetData
                .sort((a, b) => parseCurrency(b['Total Capital Invested']) - parseCurrency(a['Total Capital Invested']))
                .slice(0, 10);

            charts.topAssetsChart = new Chart(document.getElementById('topAssetsChart'), {
                type: 'bar',
                data: {
                    labels: sortedAssets.map(a => a.Asset),
                    datasets: [{
                        label: 'Capital Invested',
                        data: sortedAssets.map(a => parseCurrency(a['Total Capital Invested'])),
                        backgroundColor: '#8b5cf6',
                        borderColor: '#6d28d9',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'x',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            labels: { color: getComputedStyle(document.documentElement).getPropertyValue('--text') }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: getComputedStyle(document.documentElement).getPropertyValue('--text2'),
                                maxRotation: 45,
                                minRotation: 0
                            }
                        },
                        y: {
                            ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--text2') }
                        }
                    }
                }
            });
        }

        function destroyCharts() {
            Object.values(charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            charts = {};
        }

        function renderTable() {
            applyFilters();
        }

        function populateFilters() {
            const fields = {
                filterCategory: 'Category',
                filterStatus: 'Status',
                filterLocation: 'Location',
                filterOwner: 'Owner'
            };
            const labels = {
                filterCategory: ['All Categories', 'Todas las Categor√≠as'],
                filterStatus: ['All Statuses', 'Todos los Estados'],
                filterLocation: ['All Locations', 'Todas las Ubicaciones'],
                filterOwner: ['All Owners', 'Todos los Propietarios']
            };

            Object.entries(fields).forEach(([selectId, field]) => {
                const sel = document.getElementById(selectId);
                const current = sel.value;
                const values = [...new Set(assetData.map(r => (r[field] || '').trim()).filter(Boolean))].sort();
                sel.innerHTML = `<option value="">${labels[selectId][currentLang === 'es' ? 1 : 0]}</option>`;
                values.forEach(v => {
                    sel.innerHTML += `<option value="${v}" ${v === current ? 'selected' : ''}>${v}</option>`;
                });
            });
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const catFilter = document.getElementById('filterCategory').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const locFilter = document.getElementById('filterLocation').value;
            const ownerFilter = document.getElementById('filterOwner').value;

            filteredData = assetData.filter(row => {
                if (catFilter && (row.Category || '').trim() !== catFilter) return false;
                if (statusFilter && (row.Status || '').trim() !== statusFilter) return false;
                if (locFilter && (row.Location || '').trim() !== locFilter) return false;
                if (ownerFilter && (row.Owner || '').trim() !== ownerFilter) return false;
                if (searchTerm) {
                    return Object.values(row).some(val => String(val).toLowerCase().includes(searchTerm));
                }
                return true;
            });

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            filteredData.forEach((row) => {
                const tr = document.createElement('tr');
                tr.style.cursor = 'pointer';
                const originalIndex = assetData.indexOf(row);
                tr.onclick = () => showDetail(originalIndex);

                const status = row.Status || 'Unknown';
                const statusClass = {
                    'Active': 'status-active',
                    'Sold': 'status-sold',
                    'Dissolved': 'status-dissolved',
                    'Written Off': 'status-written-off'
                }[status] || 'status-written-off';

                tr.innerHTML = `
                    <td>${row.Asset || '-'}</td>
                    <td>${row.Location || '-'}</td>
                    <td>${row.Category || '-'}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                    <td>${row.Owner || '-'}</td>
                    <td>${row['% owned'] || '-'}%</td>
                    <td class="currency">${formatCurrency(row['Initial investment'])}</td>
                    <td class="currency">${formatCurrency(row['Total Capital Invested'])}</td>
                    <td class="currency">${formatCurrency(row['Net profit'])}</td>
                    <td class="percentage ${parsePercentage(row['ROI % on cash distributions']) < 0 ? 'negative' : ''}">${parsePercentage(row['ROI % on cash distributions']).toFixed(2)}%</td>
                `;

                tbody.appendChild(tr);
            });
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterLocation').value = '';
            document.getElementById('filterOwner').value = '';
            applyFilters();
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            assetData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                const aNum = parseCurrency(aVal);
                const bNum = parseCurrency(bVal);

                if (aNum !== 0 || bNum !== 0) {
                    return sortDirection === 'asc' ? aNum - bNum : bNum - aNum;
                }

                aVal = String(aVal || '').toLowerCase();
                bVal = String(bVal || '').toLowerCase();

                if (sortDirection === 'asc') {
                    return aVal.localeCompare(bVal);
                } else {
                    return bVal.localeCompare(aVal);
                }
            });

            document.querySelectorAll('th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            const activeHeader = Array.from(document.querySelectorAll('th')).find(th =>
                th.textContent.includes(column)
            );
            if (activeHeader) {
                activeHeader.classList.add(sortDirection === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }

            renderTable();
        }

        // ===============================
        // DETAIL MODAL
        // ===============================
        function showDetail(index) {
            const asset = assetData[index];
            document.getElementById('modalAssetName').textContent = asset.Asset || 'Asset Details';
            document.getElementById('modalDescription').textContent = asset.Description || 'No description available';

            const metricsHtml = `
                <div class="detail-item">
                    <div class="detail-label">Total Capital Invested</div>
                    <div class="detail-value currency">${formatCurrency(asset['Total Capital Invested'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Net Profit</div>
                    <div class="detail-value currency">${formatCurrency(asset['Net profit'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Total Distributions</div>
                    <div class="detail-value currency">${formatCurrency(asset['Distributions received total'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">ROI %</div>
                    <div class="detail-value">${parsePercentage(asset['ROI % on cash distributions']).toFixed(2)}%</div>
                </div>
            `;
            document.getElementById('modalMetrics').innerHTML = metricsHtml;

            const investmentHtml = `
                <div class="detail-item">
                    <div class="detail-label">Initial Investment</div>
                    <div class="detail-value currency">${formatCurrency(asset['Initial investment'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Additional Contributions</div>
                    <div class="detail-value currency">${formatCurrency(asset['Additional Capital Contributions'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Maintenance Costs (Yearly)</div>
                    <div class="detail-value currency">${formatCurrency(asset['Any other costs to maintain (yearly)'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Initial Asset Value</div>
                    <div class="detail-value currency">${formatCurrency(asset['Initial asset value'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Exit/Sale Proceeds</div>
                    <div class="detail-value currency">${formatCurrency(asset['Exit/Sale Proceeds/final balance'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Total Cash Returned</div>
                    <div class="detail-value currency">${formatCurrency(asset['Total cash returned'])}</div>
                </div>
            `;
            document.getElementById('modalInvestment').innerHTML = investmentHtml;

            const ownershipHtml = `
                <div class="detail-item">
                    <div class="detail-label">Owner</div>
                    <div class="detail-value">${asset.Owner || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">% Owned</div>
                    <div class="detail-value">${asset['% owned'] || '-'}%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Location</div>
                    <div class="detail-value">${asset.Location || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Category</div>
                    <div class="detail-value">${asset.Category || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">
                        <span class="status-badge status-${asset.Status ? asset.Status.toLowerCase().replace(' ', '-') : 'unknown'}">
                            ${asset.Status || 'Unknown'}
                        </span>
                    </div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Info Owner</div>
                    <div class="detail-value">${asset['Info Owner'] || '-'}</div>
                </div>
            `;
            document.getElementById('modalOwnership').innerHTML = ownershipHtml;

            const timelineHtml = `
                <div class="detail-item">
                    <div class="detail-label">Year Bought</div>
                    <div class="detail-value">${asset['Year bought'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Year Sold</div>
                    <div class="detail-value">${asset['Year sold'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Year of Write Off</div>
                    <div class="detail-value">${asset['Year of write off'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Target Exit Date</div>
                    <div class="detail-value">${asset['Target exit date'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Distributions Interval</div>
                    <div class="detail-value">${asset['Distributions interval'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Distribution Day</div>
                    <div class="detail-value">${asset['What day'] || '-'}</div>
                </div>
            `;
            document.getElementById('modalTimeline').innerHTML = timelineHtml;

            let linksHtml = '';
            if (asset['Link to sheet'] || asset['Documents link']) {
                linksHtml = '<ul class="links-list">';
                if (asset['Link to sheet'] && asset['Link to sheet'] !== '-') {
                    linksHtml += `<li><a href="${asset['Link to sheet']}" target="_blank">üìä Link to Sheet</a></li>`;
                }
                if (asset['Documents link'] && asset['Documents link'] !== '-') {
                    linksHtml += `<li><a href="${asset['Documents link']}" target="_blank">üìÑ Documents Link</a></li>`;
                }
                linksHtml += '</ul>';
            } else {
                linksHtml = '<p style="color: var(--text2);">No links available</p>';
            }
            document.getElementById('modalLinks').innerHTML = linksHtml;

            const taxHtml = `
                <div class="detail-item">
                    <div class="detail-label">K1 Profit/Loss (2019-2026)</div>
                    <div class="detail-value currency">${formatCurrency(asset['2019-2026 K1 Profit/Loss'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">K1 Distributions (2019-2026)</div>
                    <div class="detail-value currency">${formatCurrency(asset['2019-2026 Distributions'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Total Profit & Loss Share K1</div>
                    <div class="detail-value currency">${formatCurrency(asset['Total Profit & loss Share K1'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Written Off Amount</div>
                    <div class="detail-value currency">${formatCurrency(asset['Written off Amount'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Accounting Value if Still Held</div>
                    <div class="detail-value currency">${formatCurrency(asset['Accounting value if still held - K1'])}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Remaining to Break Even</div>
                    <div class="detail-value currency">${formatCurrency(asset['Remaining to Break Even'])}</div>
                </div>
            `;
            document.getElementById('modalTax').innerHTML = taxHtml;

            const notesHtml = `
                <div class="detail-item">
                    <div class="detail-label">Notes About Investment</div>
                    <div class="detail-value">${asset['Notes about investment'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Tax Implications / Comments</div>
                    <div class="detail-value">${asset['Tax implications/Dr. Mikes comments'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Any Other Costs</div>
                    <div class="detail-value">${asset['Any other costs to maintain (yearly)'] || '-'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Industry ROI %</div>
                    <div class="detail-value">${parsePercentage(asset['Industry ROI']).toFixed(2)}%</div>
                </div>
            `;
            document.getElementById('modalNotes').innerHTML = notesHtml;

            document.getElementById('detailModal').dataset.index = index;
            document.getElementById('detailModal').classList.add('open');
        }

        function closeModal(event) {
            if (event && event.target.id !== 'detailModal') return;
            document.getElementById('detailModal').classList.remove('open');
        }

        function deleteAsset() {
            const index = parseInt(document.getElementById('detailModal').dataset.index);
            if (confirm(`Are you sure you want to delete "${assetData[index].Asset}"?`)) {
                assetData.splice(index, 1);
                saveData();
                renderDashboard();
                closeModal();
                showToast('Asset deleted successfully', 'success');
            }
        }

        // ===============================
        // EXPORT
        // ===============================
        function exportCSV() {
            if (assetData.length === 0) {
                showToast('No data to export', 'error');
                return;
            }

            const headers = Object.keys(assetData[0]);
            const csv = [
                headers.join(','),
                ...assetData.map(row =>
                    headers.map(header => {
                        let value = row[header] || '';
                        if (String(value).includes(',') || String(value).includes('"')) {
                            value = '"' + String(value).replace(/"/g, '""') + '"';
                        }
                        return value;
                    }).join(',')
                )
            ].join('\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `assets_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showToast('CSV exported successfully', 'success');
        }

        // ===============================
        // THEME & LANGUAGE
        // ===============================
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.getAttribute('data-theme') === 'dark';

            if (isDark) {
                html.removeAttribute('data-theme');
                localStorage.setItem('nf6_theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('nf6_theme', 'dark');
            }

            destroyCharts();
            if (assetData.length > 0) {
                renderCharts();
            }
        }

        function initTheme() {
            const theme = localStorage.getItem('nf6_theme');
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        function toggleLang() {
            const current = localStorage.getItem('nf6_lang') || 'EN';
            const next = current === 'EN' ? 'ES' : 'EN';
            localStorage.setItem('nf6_lang', next);
            document.getElementById('langLabel').textContent = next;
            showToast(`Language changed to ${next}`, 'success');
        }

        function initLanguage() {
            const lang = localStorage.getItem('nf6_lang') || 'EN';
            document.getElementById('langLabel').textContent = lang;
        }

        // ===============================
        // CLOCKS & DATE
        // ===============================
        function initClocks() {
            updateClocks();
            updateTodayBadge();
            setInterval(updateClocks, 1000);
        }

        function updateClocks() {
            const formatter = new Intl.DateTimeFormat('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false,
                timeZone: 'America/Bogota'
            });

            const formatterPR = new Intl.DateTimeFormat('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false,
                timeZone: 'America/Puerto_Rico'
            });

            document.getElementById('clockCOL').textContent = formatter.format(new Date());
            document.getElementById('clockPR').textContent = formatterPR.format(new Date());
        }

        function updateTodayBadge() {
            const today = new Date().toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
            document.getElementById('todayBadge').textContent = today;
        }

        // ===============================
        // UTILITIES
        // ===============================
        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('open');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ===============================
        // STARTUP
        // ===============================
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
        });
    </script>
</body>
</html>
